<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Diner</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Operetta+12:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="images/logo.png">
</head>
<body class="gallery-page">
    <video autoplay muted loop playsinline class="background-video" id="backgroundVideo">
        <source src="1/snippet_diner.mp4" type="video/mp4">
        </video>
    
    <div class="magazine-container">
        <!-- Header -->
        <header class="header">
            <img src="images/logo.png" alt="Aurap Logo" class="brand-logo" onclick="window.location.href='index.html'" style="cursor: pointer;">
            <button class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </header>

        <!-- Burger Menu Overlay -->
        <div class="burger-overlay" id="burgerOverlay">
            <nav class="burger-menu">
                <ul class="burger-menu-list">
                    <li><a href="index.html">HOME</a></li>
                    <li><a href="contact.html">CONTACT</a></li>
                    <li><a href="about.html">ABOUT</a></li>
                    <li><a href="gallery.html?collection=aura">::AURA::</a></li>
                    <li><a href="gallery.html?collection=diner">LE DINER</a></li>
                    <li><a href="gallery.html?collection=love">22 SHADES OF LOVE</a></li>
                    <li><a href="gallery.html?collection=madeinFrance">MADE IN FRANCE</a></li>
                    <li><a href="gallery.html?collection=malvie">MALVIE MAGAZINE</a></li>
                    <li><a href="gallery.html?collection=rugby">RUGBY</a></li>
                </ul>
            </nav>
        </div>

        <!-- Gallery Content -->
        <div class="gallery-container">
            
            <!-- St Val Images Section (for love collection) -->
            <div class="st-val-container" id="stValContainer">
                <!-- Images will be dynamically loaded here -->
            </div>

            <!-- Horizontal Gallery -->
            <div class="horizontal-gallery">
                <div class="gallery-track" id="galleryTrack">
                    <!-- Images will be dynamically loaded here -->
                </div>
            </div>
            <!-- Credits -->
            <div class="credits-container" id="creditsContainer">
                <div class="floating-credits" id="creditsContent"></div>
            </div>
        </div>
    </div>

    <!-- Credits Overlay -->
    <div class="credits-overlay" id="creditsOverlay">
        <div class="credits-overlay-content">
            <div class="credits-overlay-header">
                <div class="credits-overlay-title">Credits</div>
                <button class="credits-overlay-close" onclick="closeCreditsOverlay()">&times;</button>
            </div>
            <div class="credits-overlay-text" id="creditsOverlayText"></div>
        </div>
    </div>

    <script>
        // Collection configurations
        const collections = {
            'diner': {
                title: 'LE DINER',
                directory: '1/',
                video: '1/snippet_diner.mp4',
                backgroundImage: null,
                description: 'EXPLORE LE DINER<br>COLLECTION, PHOTOGRAPHY<br>& STYLING PORTFOLIO',
                credits: '<strong>Photography:</strong> Clémence Martin, <strong>Stylist:</strong> Aura Violet, <strong>1er assistant stylist:</strong> Amélie Robelet, <strong>2ème assistant stylist:</strong> Mathilde Sizun, <strong>Make up:</strong> Sebastien Camp, Maël Fleuret, Louna Ponzio, <strong>Hair:</strong> Vasso Stathopoulou, Angèle Fumey, <strong>Models:</strong> Iris Wien, Kendrick Ewole, Simon-Pierre Pellegrin, Marie Luxi',
                creditsData: [
                    { role: 'Photography', people: ['Clémence Martin'] },
                    { role: 'Stylist', people: ['Aura Violet'] },
                    { role: '1er assistant stylist', people: ['Amélie Robelet'] },
                    { role: '2ème assistant stylist', people: ['Mathilde Sizun'] },
                    { role: 'Make up', people: ['Sebastien Camp', 'Maël Fleuret', 'Louna Ponzio'] },
                    { role: 'Hair', people: ['Vasso Stathopoulou', 'Angèle Fumey'] },
                    { role: 'Models', people: ['Iris Wien', 'Kendrick Ewole', 'Simon-Pierre Pellegrin', 'Marie Luxi'] },
                ],
                dimensions: {
                    width: '400px',
                    height: '300px',
                    itemWidth: 270 // width + gap for scroll calculations
                },
                images: [
                    'IMG_8531.JPG',
                    'IMG_8532.JPG',
                    'IMG_8533.JPG',
                    'IMG_8535.JPG',
                    'IMG_8536.JPG',
                    'IMG_8537.JPG',
                    'IMG_8538.JPG'
                ]
            },
            'malvie': {
                title: 'ELEGANCE IN CONTRAST',
                directory: '2/',
                video: null,
                backgroundImage: '2/background.jpg',
                description: 'EXPLORE MALVIE<br>MAGAZINE EDITORIAL<br>FASHION PHOTOGRAPHY',
                credits: '<strong>Photography:</strong> Zoe Yalden, <strong>Stylist:</strong> Aura Violet, <strong>Assistante stylist:</strong> Nariné Karakavorian, <strong>Make up:</strong> Sebastien Camp, <strong>Models:</strong> Lizzynmv',
                creditsData: [
                    { role: 'Photography', people: ['Zoe Yalden'] },
                    { role: 'Stylist', people: ['Aura Violet'] },
                    { role: 'Assistante stylist', people: ['Nariné Karakavorian'] },
                    { role: 'Make up', people: ['Sebastien Camp'] },
                    { role: 'Models', people: ['Lizzynmv'] },
                ],
                dimensions: {
                    width: '250px',
                    height: '350px',
                    itemWidth: 200 // width + gap for scroll calculations
                },
                images: [
                        
                    '14_Color_Pop_image5-54d.jpg',
                    '14_Color_Pop_image2_DIGITAL_COVER_TEARSHEETd_MALVIE.jpg',
                    '14_Color_Pop_image7-5df6.jpg',
                    'DSC04769copy.jpg333.jpg',
                    'DSC05229.jpg',
                    '3copy.jpg',

                    'DSC04850.jpg',
                    
                    'DSC04789.jpg',
                    'DSC04417.jpg',
                    
                    '14_Color_Pop_image8-57az.jpg',
                    'DSC05784copy.jpg',
                    'DSC04877-2.jpg',
                    
                ]
            },
            'madeinFrance': {
                title: 'MADE IN FRANCE',
                directory: '3/',
                video: '3/made_in_france.mp4',
                backgroundImage: null,
                description: 'EXPLORE MADE IN FRANCE<br>COLLECTION, FASHION<br>& STYLING PORTFOLIO',
                credits: '<strong>Starring:</strong> Saãdia Bodenmann @babhouu, <strong>Head of editorial content:</strong> @Christiereine, <strong>Prod:</strong> @Crfilmsprod, <strong>Photographer:</strong> @ineschable, <strong>Assistant light:</strong> @julesgalinat, <strong>Model:</strong> Saãdia Bodenmann @babhouu / @thefaceparis, <strong>Stylist:</strong> @auravlt, <strong>Assistante stylist:</strong> @narine.karakavorian, <strong>Hair:</strong> @salowigs, <strong>Make up:</strong> @sandra.shades, <strong>Nails:</strong> Ola Bela @loovelynailsroom, <strong>Retouch:</strong> @avivanovaa_retoucher, <strong>Set design:</strong> @sandjillstudio, <strong>Assistant set design:</strong> @ghali.kbj, Dylan Manquat @victoire.sj, <strong>Assistante prod:</strong> @lolamp3_, <strong>Journaliste:</strong> @blanche_macia',
                creditsData: [
                    { role: 'Starring', people: ['Saãdia Bodenmann @babhouu'] },
                    { role: 'Head of editorial content', people: ['@Christiereine'] },
                    { role: 'Prod', people: ['@Crfilmsprod'] },
                    { role: 'Photographer', people: ['@ineschable'] },
                    { role: 'Assistant light', people: ['@julesgalinat'] },
                    { role: 'Model', people: ['Saãdia Bodenmann @babhouu / @thefaceparis'] },
                    { role: 'Stylist', people: ['@auravlt'] },
                    { role: 'Assistante stylist', people: ['@narine.karakavorian'] },
                    { role: 'Hair', people: ['@salowigs'] },
                    { role: 'Make up', people: ['@sandra.shades'] },
                    { role: 'Nails', people: ['Ola Bela @loovelynailsroom'] },
                    { role: 'Retouch', people: ['@avivanovaa_retoucher'] },
                    { role: 'Set design', people: ['@sandjillstudio'] },
                    { role: 'Assistant set design', people: ['@ghali.kbj', 'Dylan Manquat @victoire.sj'] },
                    { role: 'Assistante prod', people: ['@lolamp3_'] },
                    { role: 'Journaliste', people: ['@blanche_macia'] },
                ],
                dimensions: {
                    width: '270px',
                    height: '380px',
                    itemWidth: 240 // width + gap for scroll calculations
                },
                images: [
                    'I.jpg',
                    'L.jpg',
                    'PRSNA-MADE-IN-FRANCES.jpg',
                    'H.jpg',
                    'LOOK2.1V3.jpg',
                    'LOOK2.2V3.jpg',
                    'G.jpg',

                    'LOOK2.3V3.jpg',
                    'LOOK6.2V3.jpg',
                    'N.jpg',
                    'P.jpg',
                    'PRSNA-MADE-IN-FRANCER.jpg',
                    'PRSNA-MADE-IN-FRANCET.jpg',
                    'K.jpg',
                ]
            },
            'aura': {
                title: 'AURA',
                directory: '4/',
                video: null,
                backgroundImage: 'images/auraBackground.jpg',
                description: 'EXPLORE AURA<br>COLLECTION, PORTRAIT<br>& FASHION PHOTOGRAPHY',
                credits: '<strong>Photography:</strong> Charlotte Favré, <strong>Stylist:</strong> Aura Violet, <strong>Model:</strong> Kateryna Kaminska, <strong>Hair:</strong> Fanta Kadiakhe, <strong>Photographer assistant:</strong> Noriane Tinh Mocoeur, <strong>MUA:</strong> Manon Louaisil',
                creditsData: [
                    { role: 'Photography', people: ['Charlotte Favré'] },
                    { role: 'Stylist', people: ['Aura Violet'] },
                    { role: 'Model', people: ['Kateryna Kaminska'] },
                    { role: 'Hair', people: ['Fanta Kadiakhe'] },
                    { role: 'Photographer assistant', people: ['Noriane Tinh Mocoeur'] },
                    { role: 'MUA', people: ['Manon Louaisil'] },
                ],
                dimensions: {
                    width: '300px',
                    height: '400px',
                    itemWidth: 320
                },
                images: [
                    '2024_11_18_charlotte-favre_4309.jpg',
                    '2024_11_18_charlotte-favre_4539.jpg',
                    '2024_11_18_charlotte-favre_4558.jpg',
                    '2024_11_18_charlotte-favre_4745.jpg',
                    '2024_11_18_charlotte-favre_4874.jpg',
                    '2024_11_18_charlotte-favre_4983.jpg',
                    '2024_11_18_charlotte-favre_5165.jpg',
                    '2024_11_18_charlotte-favre_5321.jpg',
                    '2024_11_18_charlotte-favre_5351.jpg',
                    'IMG_8206.JPG',
                    'IMG_8209.JPG',
                    'IMG_8227.JPG',
                    'IMG_8228.JPG',
                    'IMG_8232.JPG',
                    'IMG_8233.JPG'
                ]
            },
            'rugby': {
                title: 'RUGBY',
                directory: '5/',
                video: null,
                backgroundImage: 'images/rugbyBackground1.jpg',
                description: 'EXPLORE RUGBY<br>COLLECTION, SPORT<br>& FASHION PHOTOGRAPHY',
                credits: '<strong>Photographe:</strong> Thomas GAGLEWSKI @projetgirma, <strong>Modèle:</strong> Marie Ehrengardt @mariehren, <strong>Styliste:</strong> Aura Violet @auravlt, <strong>Assistante styliste:</strong> Noémie Dajon @nodjn & Lola Marteau @lolamp3_, <strong>Hair & Makeup:</strong> Aya Aradia @aya.aradia, <strong>Journaliste:</strong> François-Xavier SAVATXATH TRANG, <strong>Fashion by:</strong> @leodltr @lappartpr @albatroz.paris @Y3 @Radical PR @acme.ir',
                creditsData: [
                    { role: 'Photographe', people: ['Thomas GAGLEWSKI @projetgirma'] },
                    { role: 'Modèle', people: ['Marie Ehrengardt @mariehren'] },
                    { role: 'Styliste', people: ['Aura Violet @auravlt'] },
                    { role: 'Assistante styliste', people: ['Noémie Dajon @nodjn', 'Lola Marteau @lolamp3_'] },
                    { role: 'Hair & Makeup', people: ['Aya Aradia @aya.aradia'] },
                    { role: 'Journaliste', people: ['François-Xavier SAVATXATH TRANG'] },
                    { role: 'Fashion by', people: ['@leodltr', '@lappartpr', '@albatroz.paris', '@Y3', '@Radical PR', '@acme.ir'] },
                ],
                dimensions: {
                    width: '350px',
                    height: '450px',
                    itemWidth: 370
                },
                images: [
                    'DSC03846.jpg',
                    'DD.jpg',
                    'CC.jpg',

                    'EE.jpg',
                    'cooool.jpg',

                ]
            },
            'love': {
                title: '22 SHADES OF LOVE',
                directory: '6/',
                video: null,
                backgroundImage: 'images/22background.jpg',
                description: 'EXPLORE 22 SHADES OF LOVE<br>COLLECTION, FASHION<br>& STYLING PORTFOLIO',
                credits: '<strong>Head of editorial content:</strong> @Christiereine, <strong>Photographer:</strong> @ella.mrmt, <strong>Casting director:</strong> @eme_emmanuelle, <strong>Models:</strong> @estherrollande @saragrber @atassel @vinhe.art @darina_su @phoenixrodann @evelinagms @lyukasse @cybernewboy @alenka.ivanova2404, <strong>Stylist:</strong> @auravlt, <strong>Assistants stylist:</strong> @mathilde_sizun, @imagede_reine, <strong>Hair:</strong> @fantahairstylee @juliette_studer, <strong>Make up:</strong> @_sandra.ls_ @mariefmua @mag_about_mua, <strong>Assistante prod:</strong> @emmaalillo, <strong>Prod:</strong> @Crfilmsprod',
                creditsData: [
                    { role: 'Head of editorial content', people: ['@Christiereine'] },
                    { role: 'Photographer', people: ['@ella.mrmt'] },
                    { role: 'Casting director', people: ['@eme_emmanuelle'] },
                    { role: 'Models', people: ['@estherrollande @saragrber @atassel @vinhe.art @darina_su @phoenixrodann @evelinagms @lyukasse @cybernewboy @alenka.ivanova2404'] },
                    { role: 'Stylist', people: ['@auravlt'] },
                    { role: 'Assistants stylist', people: ['@mathilde_sizun', '@imagede_reine'] },
                    { role: 'Hair', people: ['@fantahairstylee', '@juliette_studer'] },
                    { role: 'Make up', people: ['@_sandra.ls_', '@mariefmua', '@mag_about_mua'] },
                    { role: 'Assistante prod', people: ['@emmaalillo'] },
                    { role: 'Prod', people: ['@Crfilmsprod'] },
                ],
                dimensions: {
                    width: '300px',
                    height: '350px',
                    itemWidth: 220
                },
                images: [
                    '2.jpg',
                    '3.jpg',
                    '5.jpg',
                    '6.jpg',
                    '7.jpg',
                    '9 (1).jpg',
                    '10.jpg',
                    '11.jpg',
                    '12 (1).jpg',
                    '13.jpg',
                    '14.jpg',
                    '15.jpg',
                    '16.jpg',
                    '17.jpg',
                    '18.jpg'
                ]
            }
        };

        // Get collection from URL parameter
        function getCollectionFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const collection = urlParams.get('collection');
            return collection && collections[collection] ? collection : 'diner'; // Default to diner
        }

        // Add these optimizations to your script section:

        // 1. Debounce expensive operations
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 2. (Removed) Overlay legend logic and related caching

        // 4. Throttled scroll handler
        const throttledScrollHandler = (() => {
            let rafId = null;
            
            return (e) => {
                if (rafId) return;
                
                rafId = requestAnimationFrame(() => {
                    const mouseX = e.clientX - e.currentTarget.getBoundingClientRect().left;
                    const gallery = e.currentTarget;
                    const edgeThreshold = 100;
                    const scrollSpeed = 3; // Reduced for smoother performance
                    
                    clearInterval(scrollInterval);
                    
                    if (mouseX < edgeThreshold) {
                        scrollInterval = setInterval(() => {
                            gallery.scrollLeft -= scrollSpeed;
                        }, 32); // Reduced frequency to 30fps
                    } else if (mouseX > gallery.getBoundingClientRect().width - edgeThreshold) {
                        scrollInterval = setInterval(() => {
                            gallery.scrollLeft += scrollSpeed;
                        }, 32);
                    }
                    
                    rafId = null;
                });
            };
        })();

        // 5. Replace the initializeGallery function with this optimized version:
        function initializeGallery(itemWidth) {
            const track = document.querySelector('.gallery-track');
            const gallery = document.querySelector('.horizontal-gallery');
            const items = document.querySelectorAll('.gallery-item-horizontal');
            const originalItemsCount = items.length / 2; // Half are duplicates
            
            let scrollInterval; // Declare the missing variable
            
            // Handle manual scrolling with infinite loop
            gallery.addEventListener('scroll', () => {
                const scrollLeft = gallery.scrollLeft;
                const maxScroll = itemWidth * originalItemsCount;
                
                // Reset scroll position for infinite loop
                if (scrollLeft >= maxScroll) {
                    gallery.scrollLeft = 0;
                } else if (scrollLeft <= 0 && gallery.scrollLeft !== 0) {
                    gallery.scrollLeft = maxScroll - 1;
                }
            });
            
            items.forEach((item, index) => {
                item.addEventListener('mouseenter', () => {
                    // shift effect only
                    items.forEach((other, i) => {
                        if (i < index) {
                            other.classList.add('shift-left');
                        } else if (i > index) {
                            other.classList.add('shift-right');
                        }
                    });
                });

                item.addEventListener('mouseleave', () => {
                    items.forEach(other => other.classList.remove('shift-left', 'shift-right'));
                });
            });

            // Optimized mouse move handler for auto-scrolling
            gallery.addEventListener("mousemove", (e) => {
                const rect = gallery.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const galleryWidth = rect.width;

                // Make scroll zones more progressive - increased from 100px to 200px
                const edgeThreshold = 200; 
                
                // Create variable scroll speed based on distance from center
                const centerX = galleryWidth / 2;
                const distanceFromCenter = Math.abs(mouseX - centerX);
                const maxDistance = galleryWidth / 2;
                
                // Calculate progressive scroll speed (1-6 range for smoother progression)
                const normalizedDistance = Math.min(distanceFromCenter / (maxDistance - edgeThreshold), 1);
                const progressiveSpeed = 1 + (normalizedDistance * 5); // Speed ranges from 1 to 6

                clearInterval(scrollInterval);

                if (mouseX < edgeThreshold) {
                    // Scroll left with progressive speed
                    scrollInterval = setInterval(() => {
                        gallery.scrollLeft -= progressiveSpeed;
                    }, 16); // Increased frequency to 60fps for smoother scrolling
                } else if (mouseX > galleryWidth - edgeThreshold) {
                    // Scroll right with progressive speed
                    scrollInterval = setInterval(() => {
                        gallery.scrollLeft += progressiveSpeed;
                    }, 16);
                }
            });

            gallery.addEventListener("mouseleave", () => {
                clearInterval(scrollInterval);
            });
        }

        // Optimized image loading for better LCP
        function loadImagesWithPriority(collection) {
            const galleryTrack = document.getElementById('galleryTrack');
            const allImages = [...collection.images, ...collection.images]; // Duplicate for seamless scrolling
            const originalCount = collection.images.length;
        
            allImages.forEach((imageName, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item-horizontal';
                
                // Apply custom dimensions
                galleryItem.style.width = collection.dimensions.width;
                galleryItem.style.height = collection.dimensions.height;
                
                const img = document.createElement('img');
                
                // Optimize loading for LCP
                // Load first 3 images AND last 3 images of the first set with high priority
                // since they're visible in the initial viewport
                const isFirstFew = index < 3;
                const isLastFew = index >= (originalCount - 3) && index < originalCount;
                
                if (isFirstFew || isLastFew) {
                    // Priority loading for visible images
                    img.loading = 'eager';
                    img.fetchPriority = 'high';
                } else {
                    // Lazy load remaining images
                    img.loading = 'lazy';
                    img.fetchPriority = 'low';
                }
                
                img.src = `${collection.directory}${imageName}`;
                img.alt = `${collection.title} Image ${(index % collection.images.length) + 1}`;
                img.className = 'gallery-image-horizontal';
                
                // Add size hints for better LCP
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                
                galleryItem.appendChild(img);
                galleryTrack.appendChild(galleryItem);
            });
        }

        // Load and display the selected collection
        function loadCollection(collectionKey) {
            const collection = collections[collectionKey];
            if (!collection) return;

            // Add data attribute to body for collection-specific styling
            document.body.setAttribute('data-collection', collectionKey);

            // Update page title
            document.title = collection.title;
            // Removed overlay legend update

            // Update credits
            const creditsContainer = document.getElementById('creditsContainer');
            const creditsContent = document.getElementById('creditsContent');
            if (collection.credits || collection.creditsData) {
                const formattedCredits = formatInlineCredits(collection, collectionKey);
                creditsContent.innerHTML = formattedCredits;
                creditsContainer.classList.add('active');
            } else {
                creditsContent.innerHTML = '';
                creditsContainer.classList.remove('active');
            }

            // Handle background video or image
            const video = document.getElementById('backgroundVideo');
            let backgroundImageDiv = document.getElementById('backgroundImage');
            
            if (collection.video) {
                // Show video
                video.style.display = 'block';
                video.querySelector('source').src = collection.video;
                video.load();
                
                // Hide background image if it exists
                if (backgroundImageDiv) {
                    backgroundImageDiv.style.display = 'none';
                }
            } else if (collection.backgroundImage) {
                // Hide video
                video.style.display = 'none';
                
                // Create or update background image
                if (!backgroundImageDiv) {
                    backgroundImageDiv = document.createElement('div');
                    backgroundImageDiv.id = 'backgroundImage';
                    backgroundImageDiv.className = 'background-image';
                    document.body.insertBefore(backgroundImageDiv, document.body.firstChild);
                }
                
                backgroundImageDiv.style.backgroundImage = `url('${collection.backgroundImage}')`;
                backgroundImageDiv.style.display = 'block';
                
                // Simply ensure no transform is applied:
                backgroundImageDiv.style.transform = 'none';
            } else {
                // Hide both video and background image
                video.style.display = 'none';
                if (backgroundImageDiv) {
                    backgroundImageDiv.style.display = 'none';
                }
            }

            // Clear existing gallery
            const galleryTrack = document.getElementById('galleryTrack');
            galleryTrack.innerHTML = '';

            // Handle st_val images for love collection
            const stValContainer = document.getElementById('stValContainer');
            if (collectionKey === 'love') {
                // Show and load st_val images
                stValContainer.style.display = 'flex';
                stValContainer.innerHTML = '';
                for (let i = 1; i <= 5; i++) {
                    const img = document.createElement('img');
                    img.src = `6/st_val_${i}_compressed.webp`;
                    img.alt = `St Valentine ${i}`;
                    img.className = 'st-val-image';
                    stValContainer.appendChild(img);
                }
            } else {
                // Hide st_val container for other collections
                stValContainer.style.display = 'none';
                stValContainer.innerHTML = '';
            }

            // Use optimized image loading
            loadImagesWithPriority(collection);

            // Initialize gallery functionality after a short delay for images to start loading
            setTimeout(() => {
                initializeGallery(collection.dimensions.itemWidth);
                
                // Apply mobile-specific behavior after gallery is initialized for all collections
                disableMobileTouchForAllCollections(collectionKey);
            }, 50);
        }

        // Load collection on page load
        document.addEventListener('DOMContentLoaded', () => {
            const collectionKey = getCollectionFromURL();
            loadCollection(collectionKey);
            
            // Initialize burger menu functionality
            initializeBurgerMenu();
            
            // Initialize credits overlay functionality
            initializeCreditsOverlay();
            
            // Note: Mobile touch disabling for aura is now handled in loadCollection after gallery initialization
        });

        // Function to disable card interactions but allow scrolling on mobile for all collections
        function disableMobileTouchForAllCollections(collectionKey) {
            // Check if device is mobile/tablet
            const isMobile = window.matchMedia('(max-width: 768px)').matches;
            
            if (isMobile) {
                console.log('Applying mobile-specific settings for', collectionKey);
                
                const creditsContainer = document.querySelector('.credits-container');
                
                if (creditsContainer) {
                    // Show credits for all collections on mobile
                    creditsContainer.style.display = 'flex !important';
                    
                    // Enable pointer events for love, madeinFrance, and rugby collections (for "voir plus" functionality)
                    if (collectionKey === 'love' || collectionKey === 'madeinFrance' || collectionKey === 'rugby') {
                        creditsContainer.style.pointerEvents = 'auto !important';
                    } else {
                        // Disable pointer events for other collections (no interaction needed)
                        creditsContainer.style.pointerEvents = 'none !important';
                    }
                }
                
                // Disable auto-scrolling mouse behavior for mobile
                const gallery = document.querySelector('.horizontal-gallery');
                if (gallery) {
                    // Remove mousemove and mouseleave listeners that cause auto-scrolling
                    const newGallery = gallery.cloneNode(true);
                    gallery.parentNode.replaceChild(newGallery, gallery);
                    
                    // Re-add only the scroll listener for infinite loop
                    const track = newGallery.querySelector('.gallery-track');
                    const items = newGallery.querySelectorAll('.gallery-item-horizontal');
                    const originalItemsCount = items.length / 2;
                    const itemWidth = collections[collectionKey].dimensions.itemWidth;
                    
                    newGallery.addEventListener('scroll', () => {
                        const scrollLeft = newGallery.scrollLeft;
                        const maxScroll = itemWidth * originalItemsCount;
                        
                        // Reset scroll position for infinite loop
                        if (scrollLeft >= maxScroll) {
                            newGallery.scrollLeft = 0;
                        } else if (scrollLeft <= 0 && newGallery.scrollLeft !== 0) {
                            newGallery.scrollLeft = maxScroll - 1;
                        }
                    });
                }
                
                // Disable context menu on images only
                const galleryItems = document.querySelectorAll('.gallery-item-horizontal');
                galleryItems.forEach(item => {
                    item.addEventListener('contextmenu', preventTouch, { passive: false });
                });
            }
        }

        // Function to disable card interactions but allow scrolling on mobile for aura collection (kept for backward compatibility)
        function disableMobileTouchForAura() {
            disableMobileTouchForAllCollections('aura');
        }

        // Prevent context menu function (only for long press prevention)
        function preventTouch(e) {
            if (e.type === 'contextmenu') {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }

        // Format credits for movie-style scrolling
        function formatCreditsForScrolling(creditsHtml) {
            // Convert HTML to text and clean up
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = creditsHtml;
            
            // Extract text content and split by comma or strong tags
            const text = tempDiv.textContent || tempDiv.innerText || '';
            
            // Split by commas and clean up each part
            const parts = text.split(',').map(part => part.trim()).filter(part => part.length > 0);
            
            // Join with bullet separators for movie credits style
            return parts.join(' • ');
        }

        // Build inline credits string from structured data
        function formatCreditsForScrollingStructured(creditsData) {
            if (!Array.isArray(creditsData)) return '';
            const parts = creditsData.map(entry => `${entry.role}: ${entry.people.join(', ')}`);
            return parts.join(' • ');
        }

        // Inline credits (mobile truncation for specific collections)
        function formatInlineCredits(collection, collectionKey) {
            const isMobile = window.matchMedia('(max-width: 768px)').matches;

            // Prefer structured data if available
            const fullText = Array.isArray(collection.creditsData) && collection.creditsData.length
                ? formatCreditsForScrollingStructured(collection.creditsData)
                : formatCreditsForScrolling(collection.credits || '');

            // Desktop: always show full
            if (!isMobile) return fullText;

            // Mobile: only show truncation with overlay for love, madeinFrance, and rugby collections
            if (collectionKey === 'love' || collectionKey === 'madeinFrance' || collectionKey === 'rugby') {
                if (fullText.length > 50) {
                    const truncatedText = fullText.substring(0, 47) + '...';
                    return `<span class="credits-text">${truncatedText}</span><span class="voir-plus" onclick="showCreditsOverlay()">voir plus</span>`;
                }
            }
            
            // Mobile: show full credits for all other collections
            return fullText;
        }

        // Show credits overlay
        function showCreditsOverlay() {
            const collectionKey = document.body.getAttribute('data-collection');
            const collection = collections[collectionKey];
            const overlayText = document.getElementById('creditsOverlayText');
            
            // If structured data exists, render a formatted list
            if (collection && Array.isArray(collection.creditsData) && collection.creditsData.length) {
                overlayText.innerHTML = renderCreditsListHtml(collection.creditsData);
            } else {
                // Fallback to plain text from original credits string
                overlayText.innerHTML = formatCreditsForScrolling(collection.credits || '');
            }
            
            const overlay = document.getElementById('creditsOverlay');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close credits overlay
        function closeCreditsOverlay() {
            console.log('Close credits overlay');
            const overlay = document.getElementById('creditsOverlay');
            overlay.classList.remove('active');
            
            // Restore body scroll
            document.body.style.overflow = '';
        }

        // Initialize credits overlay functionality
        function initializeCreditsOverlay() {
            const overlay = document.getElementById('creditsOverlay');
            
            // Close overlay when clicking on backdrop
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeCreditsOverlay();
                }
            });
            
            // Close overlay with escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('active')) {
                    closeCreditsOverlay();
                }
            });
        }

        // Render HTML list for overlay from structured credits
        function renderCreditsListHtml(creditsData) {
            const rows = creditsData.map((entry, index) => {
                const namesList = entry.people.map(person => `<div>${person}</div>`).join('');
                const showDivider = index < creditsData.length - 1; // Don't show divider after last item
                return `<li class="credit-row">
                    <span class="credit-role">${entry.role}</span>
                    <div class="credit-names">${namesList}</div>
                    ${showDivider ? '<div class="credit-divider"></div>' : ''}
                </li>`;
            }).join('');
            return `<ul class="credits-list">${rows}</ul>`;
        }

        // Helper function to clear scroll interval (if it exists)
        function clearScrollInterval() {
            if (typeof scrollInterval !== 'undefined') {
                clearInterval(scrollInterval);
            }
        }

        // Burger menu functionality
        function initializeBurgerMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const burgerOverlay = document.getElementById('burgerOverlay');
            
            if (menuToggle && burgerOverlay) {
                menuToggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleBurgerMenu();
                });
                
                // Close menu when clicking on overlay (but not on the menu itself)
                burgerOverlay.addEventListener('click', (e) => {
                    if (e.target === burgerOverlay) {
                        closeBurgerMenu();
                    }
                });
                
                // Close menu with escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && burgerOverlay.classList.contains('active')) {
                        closeBurgerMenu();
                    }
                });
            }
        }
        
        function toggleBurgerMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const burgerOverlay = document.getElementById('burgerOverlay');
            
            if (burgerOverlay.classList.contains('active')) {
                closeBurgerMenu();
            } else {
                openBurgerMenu();
            }
        }
        
        function openBurgerMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const burgerOverlay = document.getElementById('burgerOverlay');
            
            burgerOverlay.classList.add('active');
            menuToggle.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }
        
        function closeBurgerMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const burgerOverlay = document.getElementById('burgerOverlay');
            
            burgerOverlay.classList.remove('active');
            menuToggle.classList.remove('active');
            document.body.style.overflow = ''; // Restore scrolling
        }
    </script>
</body>
</html>
